CREATE INDEX
CREATE INDEX
CREATE INDEX
CREATE INDEX
CREATE INDEX
CREATE INDEX
CREATE INDEX
CREATE INDEX
CREATE INDEX
CREATE INDEX
== FEATURE 1a EXPLORE HOUSING PRICES: Average price of ON condos in 2020 by region (Limit 10)==
   region    | province | year | property_type | avg_price 
-------------+----------+------+---------------+-----------
 Ancaster    | ON       | 2020 | Condo         |    679999
 Aurora      | ON       | 2020 | Condo         |    639000
 Ayr         | ON       | 2020 | Condo         |   1449999
 Beamsville  | ON       | 2020 | Condo         |   1285900
 Brampton    | ON       | 2020 | Condo         |    899000
 Collingwood | ON       | 2020 | Condo         |    680000
 Dundas      | ON       | 2020 | Condo         |    873777
 Elora       | ON       | 2020 | Condo         |    989000
 Innisfil    | ON       | 2020 | Condo         |    839999
 Kenora      | ON       | 2020 | Condo         |    369900
(10 rows)

== FEATURE 1b EXPLORE INCOME DATA: Average income of ON regions in 2020 (Limit 10) ==
      region       | province | year | avg_income 
-------------------+----------+------+------------
 Barrie            | ON       | 2020 |      48910
 Brantford         | ON       | 2020 |      35440
 Centre Wellington | ON       | 2020 |       7660
 Collingwood       | ON       | 2020 |       5730
 Cornwall          | ON       | 2020 |      15650
 Elliot Lake       | ON       | 2020 |       2730
 Essa              | ON       | 2020 |      94000
 Greater Sudbury   | ON       | 2020 |      38790
 Guelph            | ON       | 2020 |      39860
 Hamilton          | ON       | 2020 |     181390
(10 rows)

FEATURE 2: Top 5 regions where $145,000 income yields HAI ≥ 25% for 2020 condos (Limit 10)
    region     | user_hai 
---------------+----------
 Osoyoos       |   264.12
 Grande Cache  |   145.15
 Athabasca     |   134.26
 St.John's     |   120.83
 Bathurst      |   116.09
 Wynyard       |   111.54
 Carlyle       |    96.80
 Logan Lake    |    90.68
 Williams Lake |    86.31
 Smithers      |    85.55
(10 rows)

FEATURE 3: Reverse Lookup – Where Did This Price Exist? (±$25,000 around 600000) (Limit 10)
          region          | property_type | year | avg_price 
--------------------------+---------------+------+-----------
 Sorrento                 | Single Family | 2025 |    609000
 Cherryville              | Single Family | 2024 |    599900
 Barriere                 | Single Family | 2024 |    595000
 Barriere                 | Single Family | 2020 |    580000
 Salmon Arm               | Single Family | 2024 |    609900
 Salmon Arm               | Single Family | 2020 |    599000
 Chase                    | Single Family | 2024 |    615000
 Chase                    | Single Family | 2023 |    598000
 Prince Albert Rm No. 461 | Single Family | 2025 |    599900
 Castlegar                | Single Family | 2020 |    579000
(10 rows)

FEATURE 4: Top 5 HAI rankings for all regions in 2020 condos (Limit 10)
 region_id |       name       | hai_index 
-----------+------------------+-----------
      3052 | Oshawa           |     13.87
      1081 | Saint John       |      8.11
      1025 | Thunder Bay      |      7.27
      1127 | Bathurst         |      6.59
      1021 | Sault Ste. Marie |      4.56
(5 rows)

FEATURE 5: Data Gap Finder - Regions with housing data but no income data for 2019 condos
 region_id | region 
-----------+--------
(0 rows)

Advanced Feature 1: Find region that has minimum x consecutive Income Growth (by default, x = 3) 
CREATE TABLE
DO
 region_id |     region_name     | max_consecutive_growth 
-----------+---------------------+------------------------
        10 | Saskatoon           |                     25
         6 | Calgary             |                     24
       465 | Winnipeg            |                     24
      1088 | Halifax             |                     24
        78 | Edmonton            |                     24
        15 | Vancouver           |                     24
      3066 | Toronto             |                     24
      3052 | Oshawa              |                     22
       419 | Victoria            |                     22
      1085 | Moncton             |                     19
         4 | Kelowna             |                     19
      3051 | Hamilton            |                     19
      3084 | Guelph              |                     19
       440 | Regina              |                     18
        22 | Nanaimo             |                     18
        59 | Canmore             |                     18
      1159 | Fredericton         |                     17
      2287 | St. John's          |                     16
        45 | Kamloops            |                     15
      3090 | Brantford           |                     15
      3055 | London              |                     14
        48 | Vernon              |                     13
       480 | Brandon             |                     13
        11 | Campbell River      |                     13
      2053 | Kingston            |                     13
        84 | Squamish            |                     13
        14 | Lethbridge          |                     11
        79 | Cranbrook           |                     10
        41 | Prince George       |                     10
      3077 | Tillsonburg         |                     10
      1017 | Barrie              |                     10
        91 | Chilliwack          |                      9
      2953 | Whitehorse          |                      9
      3108 | Woodstock           |                      9
       439 | Moose Jaw           |                      9
      1029 | Centre Wellington   |                      9
        99 | Prince Albert       |                      9
        55 | Nelson              |                      8
      1036 | Collingwood         |                      8
        71 | Courtenay           |                      8
      3057 | Windsor             |                      8
        16 | Okotoks             |                      8
      1028 | Orillia             |                      8
       396 | Terrace             |                      8
       105 | Parksville          |                      8
       476 | Steinbach           |                      7
      2302 | Bay Roberts         |                      7
      2949 | Yellowknife         |                      7
        13 | Red Deer            |                      7
      3018 | North Bay           |                      7
        51 | Penticton           |                      7
         7 | Camrose             |                      7
        93 | Port Alberni        |                      7
      1041 | Wasaga Beach        |                      7
       445 | Estevan             |                      7
        44 | Salmon Arm          |                      7
      1060 | Greater Sudbury     |                      7
       386 | Prince Rupert       |                      6
       444 | Yorkton             |                      6
      1108 | Kentville           |                      6
      1021 | Sault Ste. Marie    |                      6
      2312 | Gander              |                      6
        34 | Powell River        |                      6
        17 | Medicine Hat        |                      6
      1127 | Bathurst            |                      5
      1081 | Saint John          |                      5
       230 | Swift Current       |                      5
       471 | Weyburn             |                      5
      1075 | Summerside          |                      5
        82 | Dawson Creek        |                      5
      3111 | Sarnia              |                      5
      1245 | Miramichi           |                      5
        33 | Quesnel             |                      5
        64 | Williams Lake       |                      5
      1191 | New Glasgow         |                      5
      1074 | Charlottetown       |                      5
      1536 | Pembroke            |                      5
       203 | Lacombe             |                      5
       178 | High River          |                      5
      3081 | Leamington          |                      5
       145 | Cold Lake           |                      4
      1025 | Thunder Bay         |                      4
      1614 | Cornwall            |                      4
      2400 | Owen Sound          |                      4
      2487 | Essa                |                      4
       144 | Sylvan Lake         |                      4
       399 | Trail               |                      4
      1047 | Midland             |                      4
      1128 | Truro               |                      4
       119 | North Battleford    |                      4
       393 | Ladysmith           |                      4
        35 | Fort St. John       |                      4
      1096 | Edmundston          |                      4
       207 | Strathmore          |                      4
        20 | Grande Prairie      |                      4
      2337 | Peterborough        |                      4
       101 | Brooks              |                      4
       835 | Thompson            |                      3
       481 | Kenora              |                      3
      1026 | Elliot Lake         |                      3
      2483 | Kawartha Lakes      |                      3
      1478 | Grand Falls-Windsor |                      3
      1160 | Corner Brook        |                      3
(103 rows)

Advanced Feature 2: Heatmap
 cid |                    center                    | count | avg_price  
-----+----------------------------------------------+-------+------------
   9 | POINT(-7179003.644657773 5734072.924979726)  |  5415 |  493419.32
   3 | POINT(-13646523.175159741 6317698.134708308) | 22419 | 1582160.88
   5 | POINT(-13018878.731231296 8701460.587527879) |    11 |  297527.27
   4 | POINT(-8979810.422365207 5448233.12056754)   |  3784 |  931913.39
   0 | POINT(-6038830.234300755 6123659.475061474)  |  1368 |  369674.12
   6 | POINT(-12654527.199246716 6656973.491120731) |  4973 |  666495.61
   2 | POINT(-11719445.4704225 6686473.766229735)   |  5668 |  359814.88
   7 | POINT(-7157166.171835303 6998672.773034447)  |    35 |  312377.06
   1 | POINT(-14916354.658799123 8590491.044350738) |    62 |  570846.13
   8 | POINT(-13089975.665380472 7565226.552747703) |  1161 |  414560.43
(10 rows)

 constraint_type |  table_name   |        constraint_name         
-----------------+---------------+--------------------------------
 CHECK           | housing_price | 2200_18871_1_not_null
 CHECK           | housing_price | 2200_18871_2_not_null
 CHECK           | housing_price | 2200_18871_3_not_null
 CHECK           | housing_price | 2200_18871_4_not_null
 FOREIGN KEY     | housing_price | housing_price_property_id_fkey
 PRIMARY KEY     | housing_price | housing_price_pkey
 UNIQUE          | housing_price | uq_property_year
 CHECK           | income_data   | 2200_18843_1_not_null
 CHECK           | income_data   | 2200_18843_4_not_null
 CHECK           | income_data   | 2200_18843_3_not_null
 CHECK           | income_data   | 2200_18843_2_not_null
 FOREIGN KEY     | income_data   | income_data_region_id_fkey
 PRIMARY KEY     | income_data   | income_data_pkey
 UNIQUE          | income_data   | uq_region_year
 CHECK           | property      | 2200_18828_1_not_null
 FOREIGN KEY     | property      | property_region_id_fkey
 PRIMARY KEY     | property      | property_pkey
 CHECK           | region        | 2200_18818_2_not_null
 CHECK           | region        | 2200_18818_1_not_null
 CHECK           | region        | 2200_18818_3_not_null
 PRIMARY KEY     | region        | region_pkey
(21 rows)

Advanced Feature 5: Down Payment Simulator (15% down, 25% save, 2023 condos)
 region_id |      region      | down_payment | annual_savings | years_to_goal 
-----------+------------------+--------------+----------------+---------------
      3052 | Oshawa           |     97500.00 |       26560.00 |             4
      1081 | Saint John       |     28185.00 |        8267.50 |             4
      1025 | Thunder Bay      |     56985.00 |        7127.50 |             8
      1127 | Bathurst         |     19485.00 |        2115.00 |            10
      1159 | Fredericton      |    119985.00 |        7072.50 |            17
      1021 | Sault Ste. Marie |     97485.00 |        4785.00 |            21
       476 | Steinbach        |     45735.00 |        1447.50 |            32
        64 | Williams Lake    |     46785.00 |        1440.00 |            33
      1245 | Miramichi        |     68985.00 |        1742.50 |            40
       481 | Kenora           |     41235.00 |        1005.00 |            42
(10 rows)

Advanced Feature 4a: Invoke refresh_monthly_hai()
 refresh_monthly_hai 
---------------------
 
(1 row)

Advanced Feature 4b: Monthly HAI Summary
 summary_month | region_id |        hai         | rank_type 
---------------+-----------+--------------------+-----------
 2025-07-01    |      1245 |  73.97107897664071 | TOP
 2025-07-01    |      1075 |  64.44444444444444 | TOP
 2025-07-01    |      2949 | 59.199999999999996 | TOP
 2025-07-01    |       480 |  57.02722590139808 | TOP
 2025-07-01    |       445 |  45.18828451882845 | TOP
(5 rows)

